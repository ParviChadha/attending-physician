# FastAPI Backend

The backend captures leads from the landing page, stores them in PostgreSQL, and exposes REST endpoints the chatbot can build on.

## Requirements

- Python 3.11+
- PostgreSQL 14+ (local or hosted)

## Getting started locally

```bash
cd backend
python -m venv .venv
source .venv/bin/activate  # Windows: .venv\Scripts\activate
pip install -r requirements.txt
cp .env.example .env  # update with your credentials
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

Create the database referenced in `DATABASE_URL` before starting Uvicorn. Tables are created automatically on startup via SQLAlchemy metadata.

## Environment variables

| Name | Description |
| --- | --- |
| `DATABASE_URL` | PostgreSQL connection string. Render/Railway expose this as an env var automatically. |
| `ALLOWED_ORIGINS` | Comma-separated list of origins allowed to hit the API (include the GitHub Pages URL). |
| `API_PREFIX` | Root path for API routes, defaults to `/api`. |
| `APP_ENV` | Optional string for logging/observability.

## API surface

- `GET /api/health` – basic readiness probe.
- `POST /api/leads` – stores `{email, organization, message}` and returns the saved row.
- `GET /api/leads?limit=25` – fetches the most recent leads (handy for verifying deployments).

See the autogenerated docs at `http://localhost:8000/docs` once the server is running.

## Deploying on Render (example)

1. Create a new **PostgreSQL** instance (starter plan is fine). Copy the external connection string.
2. Create a **Web Service** from this repository, selecting the `backend` folder. Set the build command to `pip install -r backend/requirements.txt` and the start command to `cd backend && uvicorn app.main:app --host 0.0.0.0 --port 10000`.
3. Add environment variables: `DATABASE_URL` (from step 1) and `ALLOWED_ORIGINS` (e.g., `https://<user>.github.io/attending-physician`).
4. Deploy. Render gives you a public HTTPS URL you can set as `VITE_API_BASE_URL` in the frontend.

Any other PaaS (Railway, Fly, Azure Container Apps, etc.) works as long as the environment variables are provided.
